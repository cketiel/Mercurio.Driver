<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Mercurio.Driver.ViewModels"
             xmlns:models="clr-namespace:Mercurio.Driver.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Mercurio.Driver.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             BackgroundColor="#1C1C1E">

    <Shell.TitleView>
        <Grid ColumnDefinitions="*, Auto" VerticalOptions="FillAndExpand">
            <Label Text="SETTINGS" TextColor="White" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" />
            <Image Grid.Column="1" HeightRequest="25" WidthRequest="25" HorizontalOptions="End" VerticalOptions="Center" Margin="0,0,10,0">
                <Image.Source>
                    <FontImageSource FontFamily="FontAwesomeSolid" Glyph="ï€“" Color="#9A0007" />
                </Image.Source>
            </Image>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding LoadMapAppsCommand}" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto, *" Padding="15,0">
        <Label Grid.Row="0"
               Text="Select Default Maps Type"
               TextColor="White"
               FontSize="18"
               FontAttributes="Bold"
               Margin="0,20,0,10"/>

        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding AvailableMaps}"
                        SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:MapApp">
                    <VerticalStackLayout Spacing="0">
                        <Grid Padding="15" ColumnSpacing="15" BackgroundColor="#2C2C2E">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- SINGLE SOURCE OF INTERACTION: The Grid TapGesture -->
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SettingsViewModel}}, Path=SelectMapCommand}"
                                                      CommandParameter="{Binding .}"/>
                            </Grid.GestureRecognizers>

                            <Border StrokeShape="RoundRectangle 8" StrokeThickness="0" HeightRequest="45" WidthRequest="45" VerticalOptions="Center">
                                <Image Source="{Binding Icon}" Aspect="AspectFit" />
                            </Border>

                            <Label Grid.Column="1" Text="{Binding Name}" TextColor="White" FontSize="16" VerticalOptions="Center"/>
                           
                            <RadioButton Grid.Column="2"
                                         IsChecked="{Binding IsSelected}"
                                         VerticalOptions="Center"
                                         InputTransparent="True" />
                            

                        </Grid>
                        <BoxView HeightRequest="1" Color="#404040" HorizontalOptions="Fill"/>
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>